<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>SpeakRight AI (MVP)</title>
  <meta name="theme-color" content="#0b1220" />
  <style>
    :root{
      --bg:#0b1220;
      --card: rgba(255,255,255,.06);
      --border: rgba(255,255,255,.10);
      --text:#eaf0ff;
      --muted:#a7b4d6;
      --blue:#4ea1ff;
      --green:#57d18d;
      --amber:#ffd37a;
      --violet:#b7a6ff;
      --danger:#ff6b6b;
    }
    *{box-sizing:border-box;font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;}
    body{
      margin:0; min-height:100vh;
      background: radial-gradient(1200px 800px at 50% 10%, #162447 0%, var(--bg) 55%);
      color:var(--text);
      display:flex; justify-content:center; padding:18px;
    }
    .app{width:min(720px, 100%); padding-bottom:22px;}
    header{display:flex; align-items:center; justify-content:space-between; gap:12px; margin:10px 2px 14px;}
    .brand{display:flex; flex-direction:column; gap:4px;}
    .brand h1{margin:0; font-size:18px; letter-spacing:.2px;}
    .brand p{margin:0; color:var(--muted); font-size:13px; line-height:1.45;}
    .pill{
      border:1px solid var(--border);
      background: rgba(0,0,0,.18);
      color:var(--muted);
      padding:8px 10px;
      border-radius:999px;
      font-size:12px;
      white-space:nowrap;
    }

    .micArea{
      margin:12px 0 16px;
      display:flex; flex-direction:column; align-items:center; gap:10px;
    }
    .micBtn{
      width:170px;height:170px;border-radius:999px;border:0; cursor:pointer;
      background: radial-gradient(circle at 30% 25%, rgba(255,255,255,.22), rgba(255,255,255,.06) 45%, rgba(0,0,0,.18) 100%);
      outline:2px solid rgba(78,161,255,.35);
      box-shadow: 0 18px 45px rgba(0,0,0,.42), inset 0 0 0 8px rgba(78,161,255,.10);
      display:flex; flex-direction:column; gap:10px; align-items:center; justify-content:center;
      position:relative;
      -webkit-tap-highlight-color: transparent;
      transition: transform .12s ease, outline-color .12s ease;
    }
    .micBtn:active{transform:scale(.985)}
    .micIcon{font-size:54px; line-height:1}
    .micText{font-size:14px; color:var(--text); opacity:.95}
    .listening{outline-color: rgba(78,161,255,.90)}
    .pulse::after{
      content:""; position:absolute; inset:-10px; border-radius:999px;
      border:2px solid rgba(78,161,255,.55);
      animation: pulse 1.2s infinite;
    }
    @keyframes pulse{
      0%{transform:scale(.95);opacity:.9}
      80%{transform:scale(1.12);opacity:0}
      100%{transform:scale(1.12);opacity:0}
    }

    .grid{
      display:grid;
      grid-template-columns: 1fr;
      gap:12px;
    }
    .card{
      background: linear-gradient(180deg, rgba(255,255,255,.07), rgba(255,255,255,.03));
      border:1px solid var(--border);
      border-radius:20px;
      padding:14px 14px 12px;
      box-shadow:0 18px 60px rgba(0,0,0,.28);
    }
    .cardTop{display:flex; align-items:center; justify-content:space-between; gap:10px; margin-bottom:8px;}
    .title{display:flex; align-items:center; gap:9px; font-weight:700; letter-spacing:.2px; font-size:13px;}
    .tag{
      font-size:12px; color:var(--muted);
      border:1px solid var(--border);
      background: rgba(0,0,0,.14);
      padding:6px 10px; border-radius:999px;
    }
    .content{color:var(--text); line-height:1.55; font-size:15px; white-space:pre-wrap;}
    .muted{color:var(--muted)}
    .hint{font-size:12px;color:var(--muted); margin-top:10px; line-height:1.5}

    .iconDot{
      width:10px;height:10px;border-radius:999px; display:inline-block;
      background: var(--blue);
      box-shadow:0 0 0 4px rgba(78,161,255,.18);
    }
    .iconDot.green{background:var(--green); box-shadow:0 0 0 4px rgba(87,209,141,.18);}
    .iconDot.amber{background:var(--amber); box-shadow:0 0 0 4px rgba(255,211,122,.18);}
    .iconDot.violet{background:var(--violet); box-shadow:0 0 0 4px rgba(183,166,255,.18);}

    .row{
      display:flex; gap:10px; flex-wrap:wrap; align-items:center; justify-content:space-between;
      margin-top:10px;
    }
    .smallBtn{
      border:1px solid var(--border);
      background: rgba(78,161,255,.14);
      color:var(--text);
      padding:10px 12px;
      border-radius:14px;
      cursor:pointer;
      font-size:13px;
    }
    .smallBtn:active{transform:scale(.99)}
    .smallBtn.secondary{background: rgba(255,255,255,.06)}
    .smallBtn.danger{background: rgba(255,107,107,.14)}
    .inlineInput{
      width:100%;
      border:1px solid var(--border);
      background: rgba(0,0,0,.18);
      color:var(--text);
      border-radius:14px;
      padding:12px 12px;
      font-size:14px;
      outline:none;
    }
    .divider{
      height:1px; background: rgba(255,255,255,.08);
      margin:10px 0;
    }

    .scoreWrap{display:flex; gap:10px; flex-wrap:wrap}
    .metric{
      flex:1 1 160px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.14);
      border-radius:16px;
      padding:10px 12px;
    }
    .metric .k{font-size:12px;color:var(--muted); margin-bottom:6px}
    .metric .v{font-size:18px;font-weight:800}
    .lvl{color:var(--violet)}
    .warn{color:var(--amber)}
    .err{color:var(--danger)}

    footer{margin-top:12px; color:var(--muted); font-size:12px; line-height:1.55; padding:0 2px;}
  </style>
</head>
<body>
  <div class="app">
    <header>
      <div class="brand">
        <h1>SpeakRight AI <span class="muted" style="font-weight:600;">(MVP)</span></h1>
        <p>Speak in English. Youâ€™ll get a short reply + correction + Ø´Ø±Ø­ Ø¹Ø±Ø¨ÙŠ/English Ù…Ø®ØªØµØ± + quick score. Reply is spoken aloud.</p>
      </div>
      <div class="pill" id="envPill">Mode: Design MVP (No API)</div>
    </header>

    <section class="micArea">
      <button class="micBtn" id="micBtn" aria-label="Microphone">
        <div class="micIcon">ðŸŽ¤</div>
        <div class="micText" id="micText">Tap to Speak</div>
      </button>
      <div class="pill" id="statusPill">Tip: Use Chrome on Android. Allow microphone.</div>
    </section>

    <section class="grid">
      <div class="card">
        <div class="cardTop">
          <div class="title"><span class="iconDot"></span> You said</div>
          <span class="tag" id="langTag">en-US</span>
        </div>
        <div class="content muted" id="userText">â€”</div>
        <div class="divider"></div>
        <input id="manualInput" class="inlineInput" placeholder="Or type here (English)â€¦ then press Generate" />
        <div class="row">
          <button class="smallBtn secondary" id="generateBtn">Generate</button>
          <button class="smallBtn danger" id="clearBtn">Clear</button>
        </div>
        <div class="hint">This MVP simulates AI output (no API yet). Weâ€™ll replace the generator later with a real AI API.</div>
      </div>

      <div class="card">
        <div class="cardTop">
          <div class="title"><span class="iconDot violet"></span> AI Reply <span class="muted" style="font-weight:600;">(spoken)</span></div>
          <span class="tag"><button class="smallBtn" id="speakBtn" style="padding:8px 10px;border-radius:999px;">ðŸ”Š Speak</button></span>
        </div>
        <div class="content" id="aiReply">â€”</div>
      </div>

      <div class="card">
        <div class="cardTop">
          <div class="title"><span class="iconDot green"></span> Correction</div>
          <span class="tag">Short</span>
        </div>
        <div class="content" id="correction">â€”</div>
      </div>

      <div class="card">
        <div class="cardTop">
          <div class="title"><span class="iconDot amber"></span> Explanation <span class="muted" style="font-weight:600;">(Arabic + English mix)</span></div>
          <span class="tag">Max 3 points</span>
        </div>
        <div class="content" id="explanation">â€”</div>
      </div>

      <div class="card">
        <div class="cardTop">
          <div class="title"><span class="iconDot violet"></span> Quick Score</div>
          <span class="tag">Estimated level</span>
        </div>
        <div class="scoreWrap">
          <div class="metric">
            <div class="k">Grammar</div>
            <div class="v" id="gScore">â€”</div>
          </div>
          <div class="metric">
            <div class="k">Fluency</div>
            <div class="v" id="fScore">â€”</div>
          </div>
          <div class="metric">
            <div class="k">Level</div>
            <div class="v lvl" id="level">â€”</div>
          </div>
        </div>
        <div class="hint warn" id="mvpNote"></div>
      </div>
    </section>

    <footer>
      <div>Next step: connect a real AI API (OpenAI / others) and keep the same UI.</div>
      <div class="muted">Privacy tip: donâ€™t store API keys in public GitHub. Use a small backend later.</div>
    </footer>
  </div>

<script>
  // ---------- Speech Recognition ----------
  const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;

  const micBtn = document.getElementById("micBtn");
  const micText = document.getElementById("micText");
  const statusPill = document.getElementById("statusPill");

  const userTextEl = document.getElementById("userText");
  const manualInput = document.getElementById("manualInput");
  const generateBtn = document.getElementById("generateBtn");
  const clearBtn = document.getElementById("clearBtn");

  const aiReplyEl = document.getElementById("aiReply");
  const correctionEl = document.getElementById("correction");
  const explanationEl = document.getElementById("explanation");

  const gScoreEl = document.getElementById("gScore");
  const fScoreEl = document.getElementById("fScore");
  const levelEl = document.getElementById("level");
  const mvpNoteEl = document.getElementById("mvpNote");
  const speakBtn = document.getElementById("speakBtn");

  let listening = false;
  let lastReplyToSpeak = "";

  function setStatus(msg){ statusPill.textContent = msg; }

  function setListeningUI(on){
    listening = on;
    if(on){
      micBtn.classList.add("listening","pulse");
      micText.textContent = "Listeningâ€¦";
      setStatus("Listeningâ€¦ speak now.");
    }else{
      micBtn.classList.remove("listening","pulse");
      micText.textContent = "Tap to Speak";
      setStatus("Tip: Use Chrome on Android. Allow microphone.");
    }
  }

  // ---------- TTS (English only, clearer + slightly slower) ----------
  function speakEnglish(text){
    if(!text) return;
    try{
      window.speechSynthesis.cancel();
      const u = new SpeechSynthesisUtterance(text);
      u.lang = "en-US";
      u.rate = 0.82;   // slower, clearer
      u.pitch = 1.0;
      u.volume = 1.0;

      const voices = window.speechSynthesis.getVoices() || [];
      const preferred =
        voices.find(v => v.lang === "en-US" && /Google|Microsoft|Samsung/i.test(v.name)) ||
        voices.find(v => /^en/i.test(v.lang)) ||
        null;
      if(preferred) u.voice = preferred;

      window.speechSynthesis.speak(u);
    }catch(e){
      console.warn("TTS failed", e);
    }
  }

  speakBtn.addEventListener("click", () => speakEnglish(lastReplyToSpeak));

  // ---------- MVP "AI" generator (placeholder) ----------
  // This is NOT real AI. It's a simple, friendly mock so we can perfect the UI/flow.
  function mockCoachResponse(userText){
    const t = (userText || "").trim();

    // Very lightweight heuristics for nicer demo output
    const lower = t.toLowerCase();
    const hasYesterday = lower.includes("yesterday");
    const hasTomorrow = lower.includes("tomorrow");
    const hasGo = /\bgo\b/.test(lower);
    const hasSee = /\bsee\b/.test(lower);
    const hasChildrens = /\bchildrens\b/.test(lower);
    const hasI = /\bi\b/.test(lower);

    // Reply (English)
    let reply = "Thanks for sharing! Can you tell me more?";
    if(hasYesterday) reply = "Nice! What happened after that?";
    if(hasTomorrow) reply = "Sounds good! What are you planning to do tomorrow?";
    if(lower.includes("because")) reply = "Got it. Why do you think that happened?";
    if(lower.includes("i want")) reply = "Sure! What exactly do you want to do next?";

    // Correction (simple)
    let corrected = t || "â€”";
    let tips = [];

    if(hasYesterday){
      // naive past tense tweaks (demo only)
      if(hasGo){
        corrected = corrected.replace(/\bgo\b/gi, "went");
        tips.push("Ø¨Ø¹Ø¯ Yesterday Ù†Ø³ØªØ®Ø¯Ù… past tense â†’ go â†’ went");
      }else{
        tips.push("Ø¨Ø¹Ø¯ Yesterday Ø¹Ø§Ø¯Ø© Ù†Ø³ØªØ®Ø¯Ù… past tense");
      }
      if(hasSee){
        corrected = corrected.replace(/\bsee\b/gi, "saw");
        tips.push("see â†’ saw (past)");
      }
    }
    if(hasChildrens){
      corrected = corrected.replace(/\bchildrens\b/gi, "children");
      tips.push("children Ø¨Ø¯ÙˆÙ† s (plural ØµØ­ÙŠØ­)");
    }

    if(!t){
      corrected = "â€”";
      tips = ["Ù‚Ù„ Ø¬Ù…Ù„Ø© Ù‚ØµÙŠØ±Ø© Ø¨Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØŒ ÙˆØ£Ù†Ø§ Ø£ØµØ­Ø­Ù‡Ø§ Ù„Ùƒ."];
    }

    // Ensure max 3 bullets
    tips = tips.slice(0,3);
    const explanation = tips.length ? ("- " + tips.join("\n- ")) : "- Ù…Ù…ØªØ§Ø²! Ø§Ù„Ø¬Ù…Ù„Ø© ÙˆØ§Ø¶Ø­Ø©. Try using more details next time.";

    // Score + Level (mock)
    let g = 7, f = 7, lvl = "B1";
    if(t.length < 20){ f = 6; }
    if(hasYesterday && (hasGo || hasSee || hasChildrens)){ g = 6; }
    if(!hasI && t.length > 10){ g = Math.max(5, g-1); }

    // rough level estimate
    if(t.length < 18) lvl = "A2";
    if(t.length >= 18 && t.length < 45) lvl = "B1";
    if(t.length >= 45) lvl = "B2";

    return { reply, corrected, explanation, grammar:g, fluency:f, level:lvl };
  }

  function renderCoachOutput(out){
    aiReplyEl.textContent = out.reply || "â€”";
    correctionEl.textContent = out.corrected || "â€”";
    explanationEl.textContent = out.explanation || "â€”";
    gScoreEl.textContent = (out.grammar ?? "â€”") + "/10";
    fScoreEl.textContent = (out.fluency ?? "â€”") + "/10";
    levelEl.textContent = out.level || "â€”";

    lastReplyToSpeak = out.reply || "";
    mvpNoteEl.textContent = "MVP note: this output is simulated. Next we connect a real AI API with the same sections.";
  }

  function runCoach(text){
    userTextEl.textContent = text || "â€”";
    const out = mockCoachResponse(text);
    renderCoachOutput(out);
    // Speak only the English reply
    if(out.reply) speakEnglish(out.reply);
  }

  // manual generate
  generateBtn.addEventListener("click", () => runCoach(manualInput.value));
  clearBtn.addEventListener("click", () => {
    manualInput.value = "";
    userTextEl.textContent = "â€”";
    aiReplyEl.textContent = "â€”";
    correctionEl.textContent = "â€”";
    explanationEl.textContent = "â€”";
    gScoreEl.textContent = "â€”";
    fScoreEl.textContent = "â€”";
    levelEl.textContent = "â€”";
    lastReplyToSpeak = "";
    mvpNoteEl.textContent = "";
  });

  // mic click
  micBtn.addEventListener("click", () => {
    if(!SpeechRecognition){
      setStatus("Speech recognition not supported. Use Chrome or type manually.");
      return;
    }
    if(listening) return;

    const recog = new SpeechRecognition();
    recog.lang = "en-US";
    recog.interimResults = false;
    recog.maxAlternatives = 1;

    setListeningUI(true);

    recog.onresult = (event) => {
      const text = event.results?.[0]?.[0]?.transcript || "";
      runCoach(text);
    };

    recog.onerror = (e) => {
      console.warn(e);
      setStatus("Mic error. Check permissions (Site settings â†’ Microphone â†’ Allow).");
    };

    recog.onend = () => setListeningUI(false);

    try{ recog.start(); }catch(e){ setListeningUI(false); }
  });

  // Initialize a friendly demo sentence
  window.onload = () => {
    mvpNoteEl.textContent = "MVP note: simulated AI now. Next we plug real AI API.";
    // Optional: runCoach("Yesterday I go to the park and I see many childrens.");
  };
</script>
</body>
</html>
